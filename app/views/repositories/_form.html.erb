<%= form_with(model: repository, class: "row") do |form| %>
<h5> Repository </h5>
  <% if repository.errors.any? %>
    <div style="color: red">
     <h2><%= pluralize(repository.errors.count, "error") %> prohibited this repository from being saved:</h2>

      <ul>
        <% repository.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <%= form.hidden_field :owner, value: "codelittinc" %>

  <%= form.label :name, "Repository name" %>
  <%= form.text_field :name %>

  <label> Source Control Type </label>

  <div>
  <label>
      <%= form.radio_button :source_control_type, :github %>
      <span>Github</span>
  </label>

  <label>
      <%= form.radio_button :source_control_type, :azure %>
      <span>Azure</span>
  </label>
  </div>


<div style="margin: 10px 0">
  <%= form.label :supports_deploy do %>
    <%= form.check_box :supports_deploy %>
    <span>Supports Deploy with Roadrunner</span>
  <% end %>
  </div>

  <% if editing %>
  <div>
    <%= form.label :active, "Active:" %>
    <%= form.select :active, ["true", "false"], selected: repository.active %>
  </div>
  <% else %>
    <%= form.hidden_field :active, value: "true" %>
  <% end %>

<h5> Project </h5>
  <div>
    <%= form.label :name, "Project" %>
    <div class="project-selector-container" style="display: flex;">
      <%= form.select :project_id, Project.active.order(:name).pluck(:name, :id), selected: repository.project&.id %>
      <a href="<%= new_project_url %>" class="waves-effect waves-light btn btn-small green">+</a>
    </div>
  </div>

<div>
  <%= form.label :jira_project, "Jira project ID:" %>
  <%= form.text_field :jira_project %>
  </div>


<h5> Slack configuration </h5>
<div>
 <%= form.fields_for :slack_repository_info_attributes do |f| %>

<div>
   <%= f.label :dev_group, "dev group:" %>
   <%= f.text_field :dev_group, value: repository.slack_repository_info&.dev_group, placeholder: "@devs" %>
</div>
 <div>
    <%= f.label :deploy_channel, "deploy channel:" %>
   <%= f.select :deploy_channel, @channels, selected: repository.slack_repository_info&.deploy_channel %>
   </div>

<div>
   <%= f.label :dev_channel, "dev channel:" %>
   <%= f.select :dev_channel, @channels, selected: repository.slack_repository_info&.dev_channel %>
   </div>


<div>
   <%= f.label :feed_channel, "feed channel:" %>
   <%= f.select :feed_channel, @channels, selected: repository.slack_repository_info&.feed_channel %>
   </div>

 <% end %>
</div>

  <% if repository.id? %>
    <div>
      <%= link_to "Add Application", "applications/new", class: "waves-effect waves-light btn btn-small blue" %>
    </div>
  <% end %>
  <% if repository.applications.present? %>
    <div>  
      <%= render "applications/table", repository: @repository %>  
    </div>
  <% end %>

  <br>

  <div>
     <%= form.submit class: "waves-effect waves-light btn btn-small green" %>
  </div>
<% end %>